<!-- /templates/forum_upload.ejs -->
<!-- 게시물 작성 페이지 -->

<% title = pagetype; %> 


<style>
    input{
        width: 100%;
        border-radius: 5px;
        height: 30px;
        padding: 10px;
        margin-bottom: 10px;
    }

    .textbox{
        background-color: white;
        border-radius: 5px;
        padding: 10px;
        width: 100%;
        height: 800px;
    }
    #Content_text_box{
        margin: 10px;
    }
    .Content_image_box{
        display: flex;
        padding: 10px;
    }

    .file_input{
        min-height: 30px;
        padding: 5px;
        border-radius: 5px;
        background-color: white;
        border : 1px solid black
    }

    .update_label{
        font-size: 13px;
        font-weight: bolder;
        color: rgba(3, 3, 3, 0.575);
    }

</style>


<script>
    async function uploadImage() {
        const fileInput = document.getElementById('imageInput');
        const formData = new FormData();
        formData.append('image', fileInput.files[0]);

        const response = await fetch("/<%= pagetype %>/upload", { method: 'POST', body: formData });
        const data = await response.json();
        
        const editor = document.getElementById('text');
        const img_path = document.createElement('img');
        img_path.src = `/public/${data.filePath}`;
        img_path.alt = `${data.filePath}`;
        img_path.setAttribute('style','max-width: 100%;');

        editor.appendChild(img_path);
    }

    document.addEventListener('click',function(event){
        if(event.target.id === 'imageUpload'){
            uploadImage();
        }
    });

    const editableDiv = document.getElementById('editableDiv');
    const maxLength = 500;  // 최대 글자 수

    editableDiv.addEventListener('input', function() {
        // 현재 텍스트 길이를 확인
        if (editableDiv.innerText.length > maxLength) {
            // 최대 길이를 넘으면, 텍스트 자르기
            editableDiv.innerText = editableDiv.innerText.substring(0, maxLength);
        }
    });
    
</script>


<div class="forum_list_box">
    <div id="Content_text_box">
        <form action="/<%= pagetype%>/edit<%= content_id ? '?contentid='+ content_id : '' %>" method="POST">
            <label class="update_label" for="title">제목</label>
            <input type="text" id="title" name="title" value="<%= result ? result.title : '' %>" required placeholder=" 제목을 입력하세요.." maxlength="100">

            <label class="update_label" for="imageInput">첨부</label>
            <div class="Content_image_box">
                <input class="file_input" type="file" id="imageInput" accept="image/*">
                <button class="forum_button_2" id="imageUpload" type="button">올리기</button>
            </div>

            <label class="update_label" for="text">본문</label>
            <div class="textbox" id="text" contenteditable="true" aria-required="true" aria-placeholder="글쓰기" translate="no" aria-multiline="true" spellcheck="true" ></div>
            <input type="hidden">

            <br>
            <button type="submit" class="forum_button_2">게시하기</button>
        </form>
    </div>
</div>






